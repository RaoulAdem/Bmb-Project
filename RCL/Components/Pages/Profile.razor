@page "/profile"
@inject Db Db
@inject DbLocal DbLocal
@inject SharedPreferences SharedPreferences
@inject NavigationManager NavigationManager

@code {
    private ProfileViewModel? viewModel;

    protected async override void OnInitialized()
    {
        viewModel = new ProfileViewModel(Db, DbLocal, SharedPreferences, NavigationManager);
        await viewModel.LoadProfileDataAsync(); //load data
        StateHasChanged(); //update UI
    }
}

<div>
    <h1>Profile Page</h1>
    <p>Modify your personal information.</p>
</div>

@if (!viewModel.IsLoggedIn)
{
    <div>
        <p>You must log in.</p>
        <button @onclick="viewModel.SignIn">Sign in</button>
    </div>
}
else
{
    @if (viewModel.Data == null)
    {
        <p>Error...</p>
    } else
    {
        <div>
            @if (string.IsNullOrEmpty(viewModel.Data.Profile))
            {
                <img src="/_content/RCL/Images/profile.jpg" class="img-full-width" />
            } else
            {
                <img src="@viewModel.Data.Profile" class="img-full-width" />
            }

            <br />
            <label>Username:</label>
            <p style="display: inline;">@SharedPreferences.Id</p>
            <br />
            <label>Email:</label>
            <p style="display: inline;">@viewModel.Data.Email</p>
            <br />
            <label>Admin:</label>
            <p style="display: inline;">@viewModel.Data.isAdmin</p>
            <br />
            <label>Profile photo:</label>
            <InputFile OnChange="viewModel.HandleFileSelected" />
            <br />
            <button @onclick="viewModel.UploadProfile">Upload</button>
            <p role="status">@viewModel.Message</p>
        </div>
    }
}